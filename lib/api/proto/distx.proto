syntax = "proto3";

package distx;

// Collection service
service DistX {
  rpc UpsertPoints(UpsertPointsRequest) returns (UpsertPointsResponse);
  rpc SearchPoints(SearchPointsRequest) returns (SearchPointsResponse);
  rpc GetPoint(GetPointRequest) returns (GetPointResponse);
  rpc DeletePoint(DeletePointRequest) returns (DeletePointResponse);
  rpc CreateCollection(CreateCollectionRequest) returns (CreateCollectionResponse);
  rpc ListCollections(ListCollectionsRequest) returns (ListCollectionsResponse);
}

message UpsertPointsRequest {
  string collection_name = 1;
  repeated Point points = 2;
}

message Point {
  oneof id {
    string id_string = 1;
    uint64 id_integer = 2;
  }
  repeated float vector = 3;
  map<string, string> payload = 4;
}

message PointId {
  oneof id {
    string id_string = 1;
    uint64 id_integer = 2;
  }
}

message UpsertPointsResponse {
  bool success = 1;
  uint32 points_count = 2;
}

message SearchPointsRequest {
  string collection_name = 1;
  repeated float vector = 2;
  uint32 limit = 3;
  string filter = 4; // JSON filter
}

message SearchResult {
  PointId id = 1;
  float score = 2;
  map<string, string> payload = 3;
}

message SearchPointsResponse {
  repeated SearchResult results = 1;
}

message GetPointRequest {
  string collection_name = 1;
  oneof id {
    string id_string = 2;
    uint64 id_integer = 3;
  }
}

message GetPointResponse {
  Point point = 1;
  bool found = 2;
}

message DeletePointRequest {
  string collection_name = 1;
  oneof id {
    string id_string = 2;
    uint64 id_integer = 3;
  }
}

message DeletePointResponse {
  bool success = 1;
}

message CreateCollectionRequest {
  string name = 1;
  uint32 vector_dim = 2;
  string distance = 3; // "Cosine", "Euclidean", "Dot"
}

message CreateCollectionResponse {
  bool success = 1;
}

message ListCollectionsRequest {}

message ListCollectionsResponse {
  repeated string collections = 1;
}
